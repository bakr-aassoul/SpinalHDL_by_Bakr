<!DOCTYPE html>

<html lang="de" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1. Einleitung &#8212; SpinalHDL Dokumentation  Dokumentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=245627df"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=9bf55d28"></script>
    <link rel="index" title="Stichwortverzeichnis" href="genindex.html" />
    <link rel="search" title="Suche" href="search.html" />
    <link rel="prev" title="Welcome to SpinalHDL Documention" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="einleitung">
<h1><span class="section-number">1. </span>Einleitung<a class="headerlink" href="#einleitung" title="Link to this heading">¶</a></h1>
<section id="ziele-dieser-dokumentation">
<h2><span class="section-number">1.1. </span>Ziele dieser Dokumentation<a class="headerlink" href="#ziele-dieser-dokumentation" title="Link to this heading">¶</a></h2>
<p>Ziel dieser Dokumentation ist es, eine Einführung in SpinalHDL zu geben und die wichtigsten Grundlagen zu erklären.<br />
Dazu werden Praxisbeispiele vorgestellt, die den gesamten Entwicklungsprozess abdecken.<br />
Dazu gehören die Komponentenbeschreibung, die Simulation und schließlich die Generierung von Verilog- oder VHDL-Code.<br />
Neben diesem kleinen Projektbeispiel wird auch ein Beispiel zum komplexerem Design beschrieben.<br />
In unserem Fall ist dies der <strong>VexRiscv-Prozessor</strong>.</p>
</section>
<section id="motivation">
<h2><span class="section-number">1.2. </span>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h2>
<p>SpinalHDL ist eine moderne HDL (Hardwarebeschreibungssprache), die im Jahr 2014 eingeführt wurde und als Domain-Specific
Language (DSL) in Scala implementiert ist.
Sie bietet die Möglichkeit, digitale Schaltungen zu entwerfen. Danach können diese als Verilog oder VHDL-Code generiert werden, der einsatzbereit und mit FPGA sowie ASIC-Toolchains kompatibel ist.</p>
<p>Das Hauptziel von SpinalHDL ist es, die Entwicklung digitaler Schaltung einfacher, produktiver und vor allem zuverlässiger zu machen.<br />
Im Gegensatz zu alten, traditionellen HDLs wie VHDL oder Verilog, die fehleranfällig und schwerfällig sind, bietet SpinalHDL eine moderne Syntax.<br />
Damit können Entwickler Schaltungen klar, modular und wiederverwendbar beschreiben.
Durch die Integration bewährter Prinzipien aus der Softwareentwicklung wie Unit Tests, parametrisierbare Module und IDE Unterstützung entsteht ein Workflow,
der sowohl präzise als auch effizient ist.<br />
Gleichzeitig bleibt SpinalHDL voll kompatibel mit FPGA und ASIC Toolchains, da automatisch Verilog oder VHDL Code generiert wird.</p>
</section>
<section id="uberblick-uber-traditionelle-hdls-vhdl-verilog">
<h2><span class="section-number">1.3. </span>Überblick über traditionelle HDLs (VHDL/Verilog)<a class="headerlink" href="#uberblick-uber-traditionelle-hdls-vhdl-verilog" title="Link to this heading">¶</a></h2>
<p>Um die Vorteile von SpinalHDL besser einordnen zu können, lohnt sich ein Blick auf die
traditionellen Hardwarebeschreibungssprachen VHDL und Verilog. Beide wurden in den
1980er-Jahren entwickelt und haben sich als Industriestandard etabliert. Trotz ihrer
Verbreitung bringen sie jedoch erhebliche Nachteile mit sich.</p>
<ul class="simple">
<li><p><strong>Geringe Abstraktion:</strong> Strukturelle Wiederverwendung und Parametrisierung sind schwierig.</p></li>
<li><p><strong>Schlechte Fehlerdiagnose:</strong> Kompilierungsfehler liefern oft kryptische Fehlermeldungen.</p></li>
<li><p><strong>Statischer Code-Struktur:</strong> Keine Möglichkeit zur dynamischen Erzeugung von Komponenten.</p></li>
<li><p><strong>Mangelnde Integration moderner Softwarepraktiken:</strong> Unit-Tests, modulare Softwaremuster
oder IDE-Integration sind nur eingeschränkt möglich.
Diese Einschränkungen machen klassische HDLs gerade bei komplexen Projekten schwer
handhabbar und mindern sowohl die Produktivität als auch die Wartbarkeit. Genau an
dieser Stelle setzt SpinalHDL an.</p></li>
</ul>
</section>
<section id="warum-die-abkehr-sinnvoll-ist">
<h2><span class="section-number">1.4. </span>Warum die Abkehr sinnvoll ist<a class="headerlink" href="#warum-die-abkehr-sinnvoll-ist" title="Link to this heading">¶</a></h2>
<p>Moderne Hardwareentwicklungsprojekte profitieren zunehmend von Prinzipien der
Softwareentwicklung. Dazu gehören die Wiederverwendbarkeit durch modulare Bausteine,
die Testbarkeit durch Simulation und automatisierte Prüfungen sowie die Abstraktion durch
objektorientierte oder funktionale Programmierung. SpinalHDL vereint diese Stärken und
ermöglicht gleichzeitig die Generierung von synthetisierbarem Verilog- oder VHDL-Code,
der problemlos in bestehende Toolchains integriert werden kann.</p>
</section>
</section>
<section id="grundlagen-von-spinalhdl">
<h1><span class="section-number">2. </span>Grundlagen von SpinalHDL<a class="headerlink" href="#grundlagen-von-spinalhdl" title="Link to this heading">¶</a></h1>
<p>SpinalHDL ist eine Hardwarebeschreibungssprache, die als <strong>Domain Specific Language (DSL)</strong> in <strong>Scala</strong> implementiert ist. Sie bietet gegenüber VHDL und Verilog eine moderne, typensichere und modulare Beschreibung von Schaltungen.</p>
<section id="variablendeklaration-in-spinalhdl">
<h2><span class="section-number">2.1. </span>Variablendeklaration in SpinalHDL<a class="headerlink" href="#variablendeklaration-in-spinalhdl" title="Link to this heading">¶</a></h2>
<p>Die wichtigsten Typen zur Signalbeschreibung:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Typ</p></th>
<th class="head"><p>Beschreibung</p></th>
<th class="head"><p>Beispiel</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Bool</span></code></p></td>
<td><p>Ein einzelnes Bit (true/false)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">myBit</span> <span class="pre">=</span> <span class="pre">Bool()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">UInt</span></code></p></td>
<td><p>Unsigned Integer (z. B. 8 Bit)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">count</span> <span class="pre">=</span> <span class="pre">UInt(8</span> <span class="pre">bits)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SInt</span></code></p></td>
<td><p>Signed Integer</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">SInt(16</span> <span class="pre">bits)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Bits</span></code></p></td>
<td><p>Bit-Vektor ohne Interpretation</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">raw</span> <span class="pre">=</span> <span class="pre">Bits(4</span> <span class="pre">bits)</span></code></p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>In SpinalHDL beschreibt <code class="docutils literal notranslate"><span class="pre">val</span></code> eine <strong>konstante Referenz auf ein Signalobjekt</strong> – nicht das Signal selbst wie in Verilog.</p>
</div></blockquote>
</section>
<section id="signale-vs-register">
<h2><span class="section-number">2.2. </span>Signale vs. Register<a class="headerlink" href="#signale-vs-register" title="Link to this heading">¶</a></h2>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">       </span><span class="c1">// Kombinatorisch (wire)</span>
<span class="linenos">2</span><span class="kd">val</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Reg</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">))</span><span class="w">  </span><span class="c1">// Getaktetes Register</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Reg(...)</span></code> erzeugt ein Flip-Flop (Register) mit Initialwert:</p></li>
</ul>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">val</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Reg</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="n">bits</span><span class="p">))</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="steuerstrukturen">
<h2><span class="section-number">2.3. </span>Steuerstrukturen<a class="headerlink" href="#steuerstrukturen" title="Link to this heading">¶</a></h2>
<p>Wie in Scala aber spezialisiert für Hardwarelogik:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">when</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">2</span><span class="w">  </span><span class="c1">// true-Zweig</span>
<span class="linenos">3</span><span class="p">}</span><span class="w"> </span><span class="n">elsewhen</span><span class="p">(</span><span class="n">otherCond</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">4</span><span class="w">  </span><span class="c1">// anderer Zweig</span>
<span class="linenos">5</span><span class="p">}</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">6</span><span class="w">  </span><span class="c1">// fallback-Zweig</span>
<span class="linenos">7</span><span class="p">}</span>
</pre></div>
</div>
<p>Beispiel:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">val</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="linenos">2</span><span class="n">when</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">3</span><span class="w">  </span><span class="n">out</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">True</span>
<span class="linenos">4</span><span class="p">}</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">5</span><span class="w">  </span><span class="n">out</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">False</span>
<span class="linenos">6</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="bundles-schnittstellen">
<h2><span class="section-number">2.4. </span>Bundles (Schnittstellen)<a class="headerlink" href="#bundles-schnittstellen" title="Link to this heading">¶</a></h2>
<p>Ein <code class="docutils literal notranslate"><span class="pre">Bundle</span></code> ist wie ein <code class="docutils literal notranslate"><span class="pre">struct</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">val</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Bundle</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">2</span><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="linenos">3</span><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">done</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="linenos">4</span><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="linenos">5</span><span class="p">}</span>
</pre></div>
</div>
<p>Alle Signale im Bundle sind typisiert (<code class="docutils literal notranslate"><span class="pre">in</span></code>, <code class="docutils literal notranslate"><span class="pre">out</span></code>, <code class="docutils literal notranslate"><span class="pre">inout</span></code>).</p>
</section>
<section id="vektoren-und-arrays">
<h2><span class="section-number">2.5. </span>Vektoren und Arrays<a class="headerlink" href="#vektoren-und-arrays" title="Link to this heading">¶</a></h2>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">val</span><span class="w"> </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Vec</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="linenos">2</span><span class="kd">val</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Array</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">4</span><span class="p">)(</span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">))</span>
</pre></div>
</div>
<p>Vektoren erlauben z. B. Busse, Speicher, Registergruppen.</p>
</section>
<section id="komponentenstruktur">
<h2><span class="section-number">2.6. </span>Komponentenstruktur<a class="headerlink" href="#komponentenstruktur" title="Link to this heading">¶</a></h2>
<p>Eine Hardwareeinheit (Modul) ist eine Klasse, die von <code class="docutils literal notranslate"><span class="pre">Component</span></code> erbt:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Beispiel eines Moduls, das nicht über Seiten getrennt wird</span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">class</span><span class="w"> </span><span class="nc">MyModule</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">2</span><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Bundle</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">3</span><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="linenos">4</span><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="linenos">5</span><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="linenos">6</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">7</span>
<span class="linenos">8</span><span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">b</span>
<span class="linenos">9</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="top-level-mit-verilog-ausgabe">
<h2><span class="section-number">2.7. </span>Top-Level mit Verilog-Ausgabe<a class="headerlink" href="#top-level-mit-verilog-ausgabe" title="Link to this heading">¶</a></h2>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">object</span><span class="w"> </span><span class="n">MyModuleVerilog</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">2</span><span class="w">  </span><span class="n">def</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="nl">args:</span><span class="w"> </span><span class="n">Array</span><span class="p">[</span><span class="n">String</span><span class="p">])</span><span class="o">:</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">3</span><span class="w">    </span><span class="n">SpinalVerilog</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">MyModule</span><span class="p">)</span>
<span class="linenos">4</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">5</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="typisches-verhalten-vs-vhdl">
<h2><span class="section-number">2.8. </span>Typisches Verhalten vs. VHDL<a class="headerlink" href="#typisches-verhalten-vs-vhdl" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Aktion</p></th>
<th class="head"><p>VHDL</p></th>
<th class="head"><p>SpinalHDL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Signal zuweisen</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;=</span> <span class="pre">b;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">:=</span> <span class="pre">b</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Wenn-Bedingung</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">if...elsif...else</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">when...elsewhen...otherwise</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Register mit Reset</p></td>
<td><p>Prozess mit Reset</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Reg(...)</span> <span class="pre">init(...)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Strukturierte I/Os</p></td>
<td><p>Record / Port Map</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Bundle</span></code>, <code class="docutils literal notranslate"><span class="pre">in/out</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="besonderheiten">
<h2><span class="section-number">2.9. </span>Besonderheiten<a class="headerlink" href="#besonderheiten" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>stark typisiert</strong> – viele Fehler werden vom Compiler erkannt</p></li>
<li><p><strong>parametrisierbar</strong> – Bausteine können generisch sein</p></li>
<li><p><strong>simulationsfähig</strong> – direkt in Scala testbar</p></li>
<li><p><strong>Verilog/VHDL-Ausgabe</strong> – leicht integrierbar</p></li>
</ul>
</section>
<section id="tl-dr-fur-anfanger">
<h2><span class="section-number">2.10. </span>TL;DR für Anfänger<a class="headerlink" href="#tl-dr-fur-anfanger" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Du willst …</p></th>
<th class="head"><p>… dann nutze</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1 Bit Signal</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Bool()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>8 Bit Zähler</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Reg(UInt(8</span> <span class="pre">bits))</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Multiplexer</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Mux(sel,</span> <span class="pre">a,</span> <span class="pre">b)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Verzweigung</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">when</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Interface</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Bundle</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="struktur-und-aufbau-eines-spinalhdl-projekts">
<h1><span class="section-number">3. </span>Struktur und Aufbau eines SpinalHDL-Projekts<a class="headerlink" href="#struktur-und-aufbau-eines-spinalhdl-projekts" title="Link to this heading">¶</a></h1>
<section id="ordnerstruktur">
<h2><span class="section-number">3.1. </span>Ordnerstruktur<a class="headerlink" href="#ordnerstruktur" title="Link to this heading">¶</a></h2>
<p>Ein SpinalHDL-Projekt orientiert sich in der Regel an der typischen Struktur von Scala-Projekten.
Die Dateien sind so gegliedert, dass eine klare Trennung zwischen Entwurf, Test und generiertem
Code besteht. Ein mögliches Projekt kann beispielsweise folgendermaßen aufgebaut sein:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>my-spinal-project/
<span class="linenos">2</span>├── build.sbt
<span class="linenos">3</span>├── src/
<span class="linenos">4</span>│   ├── main/
<span class="linenos">5</span>│   │   └── scala/           // SpinalHDL-Komponenten
<span class="linenos">6</span>│   └── test/
<span class="linenos">7</span>│       └── scala/           // Simulation und Unit-Tests
<span class="linenos">8</span>├── generated/               // generierter Verilog/VHDL
<span class="linenos">9</span>└── README.md
</pre></div>
</div>
</section>
<section id="entwicklungsumgebung">
<h2><span class="section-number">3.2. </span>Entwicklungsumgebung<a class="headerlink" href="#entwicklungsumgebung" title="Link to this heading">¶</a></h2>
<p>Für die Arbeit mit SpinalHDL empfiehlt sich die Verwendung einer modernen Entwicklungsumgebung.<br />
In der Praxis hat sich <strong>IntelliJ IDEA</strong> mit installiertem Scala-Plugin bewährt. Damit stehen Funktionen wie Code-Vervollständigung, Syntaxhervorhebung und Refactoring zur Verfügung, die die Entwicklung deutlich vereinfachen. Als basis werden <strong>Java JDK (Java 17)</strong>, <strong>Scala 2.13</strong> sowie <strong>sbt (Scala Build Tool)</strong> benötigt
Als Build-Tool wird <strong>sbt (Scala Build Tool)</strong> eingesetzt. <strong>sbt</strong> verwaltet die Abhängigkeiten, kompiliert den Quellcode und führt Programme aus. Dadurch lässt sich der gesamte Entwicklungsprozess strukturiert und reproduzierbar abwickeln.</p>
<p>Zur Simulation kommen häufig <strong>Verilator</strong> oder <strong>GHDL</strong> zum Einsatz. Diese Werkzeuge ermöglichen eine schnelle und präzise Verifikation des Verhaltens der entworfenen Schaltungen und sind in der Community weit verbreitet.</p>
</section>
<section id="beispiel-kommando">
<h2><span class="section-number">3.3. </span>Beispiel-Kommando<a class="headerlink" href="#beispiel-kommando" title="Link to this heading">¶</a></h2>
<p>Die folgenden Befehle zeigen einen typischen Ablauf beim Arbeiten mit einem SpinalHDL-Projekt:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>sbt<span class="w"> </span>compile
<span class="linenos">2</span>sbt<span class="w"> </span>run
</pre></div>
</div>
</section>
</section>
<section id="vorteile-von-spinalhdl-gegenuber-traditionellen-hdls">
<h1><span class="section-number">4. </span>Vorteile von SpinalHDL gegenüber traditionellen HDLs<a class="headerlink" href="#vorteile-von-spinalhdl-gegenuber-traditionellen-hdls" title="Link to this heading">¶</a></h1>
<section id="syntax-und-typsicherheit">
<h2><span class="section-number">4.1. </span>Syntax und Typsicherheit<a class="headerlink" href="#syntax-und-typsicherheit" title="Link to this heading">¶</a></h2>
<p>SpinalHDL basiert auf Scala und profitiert von einer modernen, stark typisierten Syntax. Typfehler oder fehlerhafte Verbindungen zwischen Signalen werden bereits während der Kompilierung erkannt. Dadurch lassen sich viele Probleme ausschließen, die in klassischen HDLs oft erst bei der Simulation oder sogar im Syntheseprozess sichtbar werden.</p>
</section>
<section id="abstraktion-und-wiederverwendbarkeit">
<h2><span class="section-number">4.2. </span>Abstraktion und Wiederverwendbarkeit<a class="headerlink" href="#abstraktion-und-wiederverwendbarkeit" title="Link to this heading">¶</a></h2>
<p>Durch Vererbung, generische Klassen und parametrisierte Module können Komponenten einfach angepasst und wiederverwendet werden. Entwicklerinnen und Entwickler können Schleifen, Funktionen oder Bedingungen einsetzen und sogar Fabriken für Komponenten erstellen. Damit wird eine hohe Flexibilität erreicht, die klassische HDLs in dieser Form nicht bieten.</p>
</section>
<section id="fehlerdiagnose">
<h2><span class="section-number">4.3. </span>Fehlerdiagnose<a class="headerlink" href="#fehlerdiagnose" title="Link to this heading">¶</a></h2>
<p>Fehlermeldungen in SpinalHDL enthalten vollständige Stacktraces aus Scala und zeigen präzise auf die Quelle eines Problems. Wenn beispielsweise eine ungültige Zuweisung oder ein mehrfach getriebenes Signal vorliegt, wird dies direkt sichtbar. Dadurch wird die Fehlersuche erheblich vereinfacht und Entwicklungszeit eingespart.</p>
</section>
<section id="simulation-debugging">
<h2><span class="section-number">4.4. </span>Simulation &amp; Debugging<a class="headerlink" href="#simulation-debugging" title="Link to this heading">¶</a></h2>
<p>Da SpinalHDL in Scala integriert ist, können Schaltungen direkt in <strong>IntelliJ IDEA</strong> simuliert werden. Mit Hilfsmitteln wie <code class="docutils literal notranslate"><span class="pre">SimConfig</span></code> und <code class="docutils literal notranslate"><span class="pre">ScalaTest</span></code> lassen sich präzise und wiederholbare Testfälle erstellen. Dies ermöglicht eine enge Verzahnung von Entwicklung, Simulation und Verifikation und erleichtert das Debugging erheblich.</p>
</section>
</section>
<section id="entwicklungsworkflow">
<h1><span class="section-number">5. </span>Entwicklungsworkflow<a class="headerlink" href="#entwicklungsworkflow" title="Link to this heading">¶</a></h1>
<p>In SpinalHDL folgt ein typischer Designprozess drei Phasen:</p>
<ol class="arabic simple">
<li><p><strong>Komponentenbeschreibung</strong> (Design)</p></li>
<li><p><strong>Simulation &amp; Verifikation</strong> (Test)</p></li>
<li><p><strong>Codegenerierung</strong> (Export in Verilog/VHDL)</p></li>
</ol>
<section id="komponentenbeschreibung">
<h2><span class="section-number">5.1. </span>Komponentenbeschreibung<a class="headerlink" href="#komponentenbeschreibung" title="Link to this heading">¶</a></h2>
<p>Hier wird das gewünschte Verhalten in einem Modul (Component) beschrieben.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Adder</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Bundle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">b</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="erklarung">
<h3><span class="section-number">5.1.1. </span>Erklärung :<a class="headerlink" href="#erklarung" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">Adder</span> <span class="pre">extends</span> <span class="pre">Component</span></code>: definiert eine neue SpinalHDL-Komponente.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">io</span> <span class="pre">=</span> <span class="pre">new</span> <span class="pre">Bundle</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>: legt die I/O-Schnittstelle fest.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>: 8-Bit Eingänge (z. B. zwei Summanden)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>: 8-Bit Ausgang (Summe)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">io.result</span> <span class="pre">:=</span> <span class="pre">io.a</span> <span class="pre">+</span> <span class="pre">io.b</span></code>: beschreibt die Logik: Addition von <code class="docutils literal notranslate"><span class="pre">a</span></code> und <code class="docutils literal notranslate"><span class="pre">b</span></code>, das Ergebnis wird ausgegeben.</p></li>
</ul>
<p><strong>Das ist reine Kombinatorik</strong>, kein Register (d.h. keine Speicherung, kein Takt).</p>
</section>
</section>
<section id="simulationsmoglichkeiten">
<h2><span class="section-number">5.2. </span>Simulationsmöglichkeiten<a class="headerlink" href="#simulationsmoglichkeiten" title="Link to this heading">¶</a></h2>
<p>Mit SpinalHDL kannst du direkt in Scala simulieren.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">SimConfig</span><span class="p">.</span><span class="n">withWave</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Adder</span><span class="p">).</span><span class="n">doSim</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">dut</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">  </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">4</span>
<span class="w">  </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">7</span>
<span class="w">  </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">forkStimulus</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="w">  </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">waitSampling</span><span class="p">()</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">toInt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">11</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="id1">
<h3><span class="section-number">5.2.1. </span>Erklärung :<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SimConfig.withWave</span></code>: Aktiviert Wellenform-Ausgabe (<code class="docutils literal notranslate"><span class="pre">.vcd</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compile(new</span> <span class="pre">Adder)</span></code>: kompiliert die Adder-Komponente für Simulation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">doSim</span> <span class="pre">{</span> <span class="pre">dut</span> <span class="pre">=&gt;</span> <span class="pre">...</span> <span class="pre">}</span></code>: definiert, was im Simulationslauf passieren soll.</p></li>
</ul>
<p><strong>Innerhalb des Blocks:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dut.io.a</span> <span class="pre">#=</span> <span class="pre">4</span></code>: Setzt Eingang <code class="docutils literal notranslate"><span class="pre">a</span></code> auf 4</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dut.io.b</span> <span class="pre">#=</span> <span class="pre">7</span></code>: Setzt Eingang <code class="docutils literal notranslate"><span class="pre">b</span></code> auf 7</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forkStimulus(10)</span></code>: Erzeugt Taktsignal mit Periodendauer 10</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">waitSampling()</span></code>: Wartet auf eine steigende Taktflanke</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">assert(...)</span></code>: Prüft, ob das Ergebnis tatsächlich 11 ist</p></li>
</ul>
<blockquote>
<div><p>Hinweis: Die Simulation verwendet dieselbe Logik wie der Synthese-Code, sie ist somit <strong>cycle-accurate</strong>.</p>
</div></blockquote>
</section>
</section>
<section id="code-generieren-verilog-vhdl">
<h2><span class="section-number">5.3. </span>Code generieren (Verilog/VHDL)<a class="headerlink" href="#code-generieren-verilog-vhdl" title="Link to this heading">¶</a></h2>
<p>Mit einem einfachen Aufruf generierst du RTL-Code:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">SpinalVerilog</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Adder</span><span class="p">)</span>
<span class="nc">SpinalVhdl</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Adder</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SpinalVerilog(...)</span></code>: erzeugt eine <code class="docutils literal notranslate"><span class="pre">.v</span></code>-Datei (Verilog)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SpinalVhdl(...)</span></code>: erzeugt eine <code class="docutils literal notranslate"><span class="pre">.vhd</span></code>-Datei (VHDL)</p></li>
<li><p>Die Datei enthält exakt das, was von Tools wie <strong>Vivado</strong>, <strong>Quartus</strong>, <strong>Yosys</strong>, etc. verarbeitet werden kann</p></li>
</ul>
<p>Der generierte Code wird im aktuellen Arbeitsverzeichnis gespeichert oft in einem Unterordner wie <code class="docutils literal notranslate"><span class="pre">./rtl/</span></code> oder <code class="docutils literal notranslate"><span class="pre">./simWorkspace/Adder</span></code>.</p>
</section>
<section id="zusammengefasst">
<h2><span class="section-number">5.4. </span>Zusammengefasst:<a class="headerlink" href="#zusammengefasst" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Schritt</p></th>
<th class="head"><p>Ziel</p></th>
<th class="head"><p>Beispiel</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Komponentenbau</p></td>
<td><p>Schaltung entwerfen</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Adder</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Simulation</p></td>
<td><p>Verhalten testen</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">doSim</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Codegenerierung</p></td>
<td><p>Verilog/VHDL für Synthesis</p></td>
<td><p>`SpinalVerilog(…)</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="praxisbeispiele">
<h1><span class="section-number">6. </span>Praxisbeispiele<a class="headerlink" href="#praxisbeispiele" title="Link to this heading">¶</a></h1>
<p>Im Folgenden werden einige typische Praxisbeispiele vorgestellt, die den Einsatz von SpinalHDL verdeutlichen. Jedes Beispiel enthält die Beschreibung des Moduls, eine Testbench zur Simulation sowie die Möglichkeit, eine Verilog-Datei zu generieren. Auf diese Weise wird der komplette Ablauf von der Modellierung über die Verifikation bis zur Codegenerierung sichtbar.</p>
<section id="comparator">
<h2><span class="section-number">6.1. </span>Comparator<a class="headerlink" href="#comparator" title="Link to this heading">¶</a></h2>
<p>Ein Comparator vergleicht zwei Werte (<code class="docutils literal notranslate"><span class="pre">a</span></code> und <code class="docutils literal notranslate"><span class="pre">b</span></code>) und erzeugt Ausgänge für:</p>
<ul class="simple">
<li><p>Gleichheit (<code class="docutils literal notranslate"><span class="pre">equal</span></code>)</p></li>
<li><p>Größer-als (<code class="docutils literal notranslate"><span class="pre">greater</span></code>)</p></li>
<li><p>Kleiner-als (<code class="docutils literal notranslate"><span class="pre">less</span></code>)</p></li>
</ul>
<p><strong>Projektstruktur</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>comparator-spinalhdl/
├── build.sbt
├── src/
│   ├── main/scala/
│   │   ├── Comparator.scala        // Comparator-Modul
│   │   └── ComparatorVerilog.scala // Verilog-Generierung
│   │   └── ComparatorVhdl.scala    // VHDL-Generierung
│   └── test/scala/
│       └── ComparatorSim.scala     // Testbench
└── README.md
</pre></div>
</div>
<p><strong>Aufbau des Moduls</strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Comparator</span><span class="p">(</span><span class="n">width</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">noIoPrefix</span><span class="p">()</span>
<span class="w">  </span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;Comparator&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Bundle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w">  </span><span class="nc">UInt</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">b</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w">  </span><span class="nc">UInt</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">equal</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">greater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">less</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">equal</span><span class="w">   </span><span class="o">:=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">b</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">greater</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">b</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">less</span><span class="w">    </span><span class="o">:=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">b</span>

<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">equal</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;eq&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">greater</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;gt&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">less</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;lt&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Was macht das Modul?</strong></p>
<ul class="simple">
<li><p>Es nimmt zwei <code class="docutils literal notranslate"><span class="pre">UInt</span></code>-Eingänge <code class="docutils literal notranslate"><span class="pre">a</span></code> und <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p></li>
<li><p>Es vergleicht sie in Echtzeit.</p></li>
<li><p>Setzt genau ein Ergebnis-Signal auf <code class="docutils literal notranslate"><span class="pre">true</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">equal</span></code>: wenn <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">b</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">greater</span></code>: wenn <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">b</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less</span></code>: wenn <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;</span> <span class="pre">b</span></code></p></li>
</ul>
</li>
</ul>
<p><strong>Testbench: <code class="docutils literal notranslate"><span class="pre">ComparatorSim.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="nn">sim</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">ComparatorSim</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nc">SimConfig</span>
<span class="w">      </span><span class="p">.</span><span class="n">withVcdWave</span>
<span class="w">      </span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Comparator</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">doSim</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">dut</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="n">assert</span><span class="p">(</span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">equal</span><span class="p">.</span><span class="n">toBoolean</span><span class="p">)</span>

<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">7</span>
<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">4</span>
<span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="n">assert</span><span class="p">(</span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">greater</span><span class="p">.</span><span class="n">toBoolean</span><span class="p">)</span>

<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">8</span>
<span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="n">assert</span><span class="p">(</span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">less</span><span class="p">.</span><span class="n">toBoolean</span><span class="p">)</span>

<span class="w">        </span><span class="n">simSuccess</span><span class="p">()</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Verilog-Ausgabe: <code class="docutils literal notranslate"><span class="pre">ComparatorVerilog.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">ComparatorVerilog</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nc">SpinalConfig</span><span class="p">(</span>
<span class="w">      </span><span class="n">targetDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;generated/verilog&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="n">oneFilePerComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">).</span><span class="n">generateVerilog</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Comparator</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;Comparator&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>VHDL-Ausgabe: <code class="docutils literal notranslate"><span class="pre">ComparatorVhdl.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">ComparatorVhdl</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nc">SpinalConfig</span><span class="p">(</span>
<span class="w">      </span><span class="n">targetDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;generated/vhdl&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="n">oneFilePerComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">).</span><span class="n">generateVhdl</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Comparator</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;Comparator&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Verwendung</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbt<span class="w"> </span>compile
sbt<span class="w"> </span><span class="s2">&quot;runMain ComparatorSim&quot;</span>
sbt<span class="w"> </span><span class="s2">&quot;runMain ComparatorVerilog&quot;</span>
sbt<span class="w"> </span><span class="s2">&quot;runMain ComparatorVhdl&quot;</span>
</pre></div>
</div>
<p>Ergebnis: Die Dateien <code class="docutils literal notranslate"><span class="pre">Comparator.v</span></code> und <code class="docutils literal notranslate"><span class="pre">Comparator.vhd</span></code> werden generiert, und die Testbench prüft die Vergleichsfunktionen.</p>
<p><strong>Generierter VHDL-Code: <code class="docutils literal notranslate"><span class="pre">Comparator.vhd</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="w"> </span><span class="nc">Generator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">SpinalHDL</span><span class="w"> </span><span class="n">v1</span><span class="mf">.9.1</span><span class="w">    </span><span class="n">git</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="n">cba1927b2fff87b0d54e8bbecec94e7256520e4</span>
<span class="o">--</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Comparator</span>

<span class="n">library</span><span class="w"> </span><span class="n">ieee</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">ieee</span><span class="p">.</span><span class="n">std_logic_1164</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">ieee</span><span class="p">.</span><span class="n">numeric_std</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>

<span class="n">library</span><span class="w"> </span><span class="n">work</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">pkg_scala2hdl</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">pkg_enum</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>


<span class="n">entity</span><span class="w"> </span><span class="nc">Comparator</span><span class="w"> </span><span class="n">is</span>
<span class="w">  </span><span class="n">port</span><span class="p">(</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">unsigned</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">unsigned</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">eq</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">gt</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">lt</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">std_logic</span>
<span class="w">  </span><span class="p">);</span>
<span class="n">end</span><span class="w"> </span><span class="nc">Comparator</span><span class="p">;</span>

<span class="n">architecture</span><span class="w"> </span><span class="n">arch</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nc">Comparator</span><span class="w"> </span><span class="n">is</span>

<span class="n">begin</span>
<span class="w">  </span><span class="n">eq</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_toStdLogic</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">  </span><span class="n">gt</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_toStdLogic</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<span class="w">  </span><span class="n">lt</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_toStdLogic</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="n">end</span><span class="w"> </span><span class="n">arch</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Generierter Verilog-Code: <code class="docutils literal notranslate"><span class="pre">Comparator.v</span></code></strong></p>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="c1">// Generator : SpinalHDL v1.9.1    git head : 9cba1927b2fff87b0d54e8bbecec94e7256520e4</span>
<span class="c1">// Component : Comparator</span>

<span class="no">`timescale</span><span class="w"> </span><span class="mh">1</span><span class="n">ns</span><span class="o">/</span><span class="mh">1</span><span class="n">ps</span><span class="w"> </span>
<span class="k">module</span><span class="w"> </span><span class="n">Comparator</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">input</span><span class="w">      </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">a</span><span class="p">,</span>
<span class="w">  </span><span class="k">input</span><span class="w">      </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">b</span><span class="p">,</span>
<span class="w">  </span><span class="k">output</span><span class="w">              </span><span class="n">eq</span><span class="p">,</span>
<span class="w">  </span><span class="k">output</span><span class="w">              </span><span class="n">gt</span><span class="p">,</span>
<span class="w">  </span><span class="k">output</span><span class="w">              </span><span class="n">lt</span>
<span class="p">);</span>


<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">gt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">lt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>

<span class="k">endmodule</span>
</pre></div>
</div>
</section>
<section id="zahler">
<h2><span class="section-number">6.2. </span>Zähler<a class="headerlink" href="#zahler" title="Link to this heading">¶</a></h2>
<p>Ein Zähler zählt bei jedem Takt um 1 nach oben. Er kann in vielen Anwendungen eingesetzt werden, z. B. als Zeitgeber, Schleifenzähler oder zur Adressierung.</p>
<p><strong>Projektstruktur</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>counter-spinalhdl/
├── build.sbt
├── src/
│   ├── main/scala/
│   │   ├── Counter.scala        // Zähler-Modul
│   │   └── CounterVerilog.scala // Verilog-Generierung
│   │   └── CounterVhdl.scala    // VHDL-Generierung
│   └── test/scala/
│       └── CounterSim.scala     // Testbench
└── README.md
</pre></div>
</div>
<p><strong>Aufbau des Moduls</strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Counter</span><span class="p">(</span><span class="n">width</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">noIoPrefix</span><span class="p">()</span>
<span class="w">  </span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;Counter&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Bundle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">reset</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">value</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Reg</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="n">bits</span><span class="p">))</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">  </span><span class="n">when</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">reset</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">.</span><span class="n">elsewhen</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">enable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">count</span>

<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">enable</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;enable&quot;</span><span class="p">);</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">reset</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;reset&quot;</span><span class="p">);</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Was macht das Modul?</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enable</span></code>: Wenn aktiv, zählt der Zähler hoch.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reset</span></code>: Wenn aktiv, wird der Zähler auf 0 gesetzt.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Der aktuelle Zählerwert.</p></li>
</ul>
<p><strong>Testbench: <code class="docutils literal notranslate"><span class="pre">CounterSim.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">sim</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="nn">sim</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">CounterSim</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nc">SimConfig</span>
<span class="w">      </span><span class="p">.</span><span class="n">withVcdWave</span><span class="w">                </span><span class="c1">// VCD für GTKWave</span>
<span class="w">      </span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Counter</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">doSim</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">dut</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">forkStimulus</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">reset</span><span class="w">  </span><span class="o">#=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">enable</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">waitSampling</span><span class="p">()</span>

<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">reset</span><span class="w">  </span><span class="o">#=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">enable</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="kc">true</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">waitSampling</span><span class="p">()</span>
<span class="w">          </span><span class="n">println</span><span class="p">(</span><span class="s">s&quot;Zählerwert = </span><span class="si">${</span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">toBigInt</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">simSuccess</span><span class="p">()</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Verilog-Ausgabe: <code class="docutils literal notranslate"><span class="pre">CounterVerilog.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">CounterVerilog</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="nc">SpinalConfig</span><span class="p">(</span><span class="n">targetDirectory</span><span class="o">=</span><span class="s">&quot;generated/verilog&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oneFilePerComponent</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">generateVerilog</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Counter</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;Counter&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>VHDL-Ausgabe: <code class="docutils literal notranslate"><span class="pre">CounterVhdl.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>
<span class="k">object</span><span class="w"> </span><span class="nc">CounterVhdl</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="nc">SpinalConfig</span><span class="p">(</span><span class="n">targetDirectory</span><span class="o">=</span><span class="s">&quot;generated/vhdl&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oneFilePerComponent</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">generateVhdl</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Counter</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;Counter&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Verwendung</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbt<span class="w"> </span>compile
sbt<span class="w"> </span><span class="s2">&quot;runMain CounterSim&quot;</span>
sbt<span class="w"> </span><span class="s2">&quot;runMain CounterVerilog&quot;</span>
</pre></div>
</div>
<p><strong>Ergebnis:</strong>
Die Dateien <code class="docutils literal notranslate"><span class="pre">Counter.v</span></code> und <code class="docutils literal notranslate"><span class="pre">Counter.vhd</span></code> werden generiert. In der Simulation zählt der Wert bei <code class="docutils literal notranslate"><span class="pre">enable</span> <span class="pre">=</span> <span class="pre">true</span></code> hoch.</p>
<p><strong>Generierter VHDL-Code: <code class="docutils literal notranslate"><span class="pre">Counter.vhd</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="w"> </span><span class="nc">Generator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">SpinalHDL</span><span class="w"> </span><span class="n">v1</span><span class="mf">.9.1</span><span class="w">    </span><span class="n">git</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="n">cba1927b2fff87b0d54e8bbecec94e7256520e4</span>
<span class="o">--</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Counter</span>

<span class="n">library</span><span class="w"> </span><span class="n">ieee</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">ieee</span><span class="p">.</span><span class="n">std_logic_1164</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">ieee</span><span class="p">.</span><span class="n">numeric_std</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>

<span class="n">library</span><span class="w"> </span><span class="n">work</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">pkg_scala2hdl</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">pkg_enum</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>


<span class="n">entity</span><span class="w"> </span><span class="nc">Counter</span><span class="w"> </span><span class="n">is</span>
<span class="w">  </span><span class="n">port</span><span class="p">(</span>
<span class="w">    </span><span class="n">enable</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">reset</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">unsigned</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">clk</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">reset_1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">std_logic</span>
<span class="w">  </span><span class="p">);</span>
<span class="n">end</span><span class="w"> </span><span class="nc">Counter</span><span class="p">;</span>

<span class="n">architecture</span><span class="w"> </span><span class="n">arch</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nc">Counter</span><span class="w"> </span><span class="n">is</span>

<span class="w">  </span><span class="n">signal</span><span class="w"> </span><span class="n">zz_value</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">unsigned</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="n">begin</span>
<span class="w">  </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">zz_value</span><span class="p">;</span>
<span class="w">  </span><span class="n">process</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span><span class="w"> </span><span class="n">reset_1</span><span class="p">)</span>
<span class="w">  </span><span class="n">begin</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">reset_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span><span class="n">zz_value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_unsigned</span><span class="p">(</span><span class="s">&quot;0000&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">elsif</span><span class="w"> </span><span class="n">rising_edge</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="n">zz_value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_unsigned</span><span class="p">(</span><span class="s">&quot;0000&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">else</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="n">zz_value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">zz_value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pkg_unsigned</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">  </span><span class="n">end</span><span class="w"> </span><span class="n">process</span><span class="p">;</span>

<span class="n">end</span><span class="w"> </span><span class="n">arch</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Generierter Verilog-Code: <code class="docutils literal notranslate"><span class="pre">Counter.v</span></code></strong></p>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="c1">// Generator : SpinalHDL v1.9.1    git head : 9cba1927b2fff87b0d54e8bbecec94e7256520e4</span>
<span class="c1">// Component : Counter</span>

<span class="no">`timescale</span><span class="w"> </span><span class="mh">1</span><span class="n">ns</span><span class="o">/</span><span class="mh">1</span><span class="n">ps</span><span class="w"> </span>
<span class="k">module</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">input</span><span class="w">               </span><span class="n">enable</span><span class="p">,</span>
<span class="w">  </span><span class="k">input</span><span class="w">               </span><span class="n">reset</span><span class="p">,</span>
<span class="w">  </span><span class="k">output</span><span class="w">     </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">value</span><span class="p">,</span>
<span class="w">  </span><span class="k">input</span><span class="w">               </span><span class="n">clk</span><span class="p">,</span>
<span class="w">  </span><span class="k">input</span><span class="w">               </span><span class="n">reset_1</span>
<span class="p">);</span>

<span class="w">  </span><span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_value</span><span class="p">;</span>

<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_value</span><span class="p">;</span>
<span class="w">  </span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="n">reset_1</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">reset_1</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="w">      </span><span class="n">_zz_value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b0000</span><span class="p">;</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="w">        </span><span class="n">_zz_value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b0000</span><span class="p">;</span>
<span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="w">          </span><span class="n">_zz_value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b0001</span><span class="p">);</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">      </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">  </span><span class="k">end</span>


<span class="k">endmodule</span>
</pre></div>
</div>
</section>
<section id="taktteiler-clock-divider">
<h2><span class="section-number">6.3. </span>Taktteiler (Clock Divider)<a class="headerlink" href="#taktteiler-clock-divider" title="Link to this heading">¶</a></h2>
<p>Ein Taktteiler erzeugt aus einem schnellen Eingangstakt einen langsameren Ausgangstakt, indem er Takte zählt und z. B. nur jedes 256. Signal durchlässt.</p>
<p><strong>Projektstruktur</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>clockdivider-spinalhdl/
├── build.sbt
├── src/
│   ├── main/scala/
│   │   ├── ClockDivider.scala        // Taktteiler-Modul
│   │   └── ClockDividerVerilog.scala // Verilog-Generierung
│   │   └── ClockDividerVhdl.scala    // VHDL-Generierung
│   └── test/scala/
│       └── ClockDividerSim.scala     // Testbench
└── README.md
</pre></div>
</div>
<p><strong>Aufbau des Moduls</strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ClockDivider</span><span class="p">(</span><span class="n">divisorWidth</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">noIoPrefix</span><span class="p">()</span>
<span class="w">  </span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;ClockDivider&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Bundle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">clkOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="w">     </span><span class="kd">val</span><span class="w"> </span><span class="n">counterO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="n">divisorWidth</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">   </span><span class="c1">//  internal counter</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Zähler läuft kontinuierlich</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Reg</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="n">divisorWidth</span><span class="w"> </span><span class="n">bits</span><span class="p">))</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">  </span><span class="n">counter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="w">  </span><span class="c1">// höchstwertiges Bit als geteiltes Taktsignal</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">clkOut</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">counter</span><span class="p">.</span><span class="n">msb</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">counterO</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">counter</span>

<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">clkOut</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;clkOut&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">counterO</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;counter&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Was macht das Modul?</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">counter</span></code>: Zählt kontinuierlich bei jedem Takt.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msb</span></code>: Der höchste Bitwert des Zählers (Most Significant Bit) wird als geteilter Takt ausgegeben.</p></li>
<li><p><strong>Beispiel</strong>: Bei <code class="docutils literal notranslate"><span class="pre">divisorWidth</span> <span class="pre">=</span> <span class="pre">8</span></code> ergibt sich ein Teiler von 256 (halbe Periode = 128 Takte).</p></li>
</ul>
<p><strong>Testbench: <code class="docutils literal notranslate"><span class="pre">ClockDividerSim.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="nn">sim</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">ClockDividerSim</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nc">SimConfig</span><span class="p">.</span><span class="n">withVcdWave</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">ClockDivider</span><span class="p">(</span><span class="mi">8</span><span class="p">)).</span><span class="n">doSim</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">dut</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">      </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">forkStimulus</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="mi">300</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">waitSampling</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">          </span><span class="n">println</span><span class="p">(</span><span class="s">s&quot;Takt </span><span class="si">$</span><span class="n">i</span><span class="s">: clkOut = </span><span class="si">${</span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clkOut</span><span class="p">.</span><span class="n">toBoolean</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="n">simSuccess</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Verilog-Ausgabe: <code class="docutils literal notranslate"><span class="pre">ClockDividerVerilog.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">ClockDividerVerilog</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nc">SpinalConfig</span><span class="p">(</span>
<span class="w">      </span><span class="n">targetDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;generated/verilog&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="n">oneFilePerComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">).</span><span class="n">generateVerilog</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">ClockDivider</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;ClockDivider&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>VHDL-Ausgabe: <code class="docutils literal notranslate"><span class="pre">ClockDividerVhdl.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">ClockDividerVhdl</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nc">SpinalConfig</span><span class="p">(</span>
<span class="w">      </span><span class="n">targetDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;generated/vhdl&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="n">oneFilePerComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">).</span><span class="n">generateVhdl</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">ClockDivider</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;ClockDivider&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Verwendung</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbt<span class="w"> </span>compile
sbt<span class="w"> </span><span class="s2">&quot;runMain ClockDividerSim&quot;</span>
sbt<span class="w"> </span><span class="s2">&quot;runMain ClockDividerVerilog&quot;</span>
sbt<span class="w"> </span><span class="s2">&quot;runMain ClockDividerVhdl&quot;</span>
</pre></div>
</div>
<p>Das erzeugt:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ClockDivider.v</span></code>: die Verilog-Datei</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ClockDivider.vhd</span></code>: die Verilog-Datei</p></li>
<li><p>und zeigt die Simulation mit <code class="docutils literal notranslate"><span class="pre">clkOut</span></code>, der etwa alle 128 Takte wechselt.</p></li>
</ul>
<p><strong>Generierter VHDL-Code: <code class="docutils literal notranslate"><span class="pre">ClockDivider.vhd</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="w"> </span><span class="nc">Generator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">SpinalHDL</span><span class="w"> </span><span class="n">v1</span><span class="mf">.9.1</span><span class="w">    </span><span class="n">git</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="n">cba1927b2fff87b0d54e8bbecec94e7256520e4</span>
<span class="o">--</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">ClockDivider</span>

<span class="n">library</span><span class="w"> </span><span class="n">ieee</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">ieee</span><span class="p">.</span><span class="n">std_logic_1164</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">ieee</span><span class="p">.</span><span class="n">numeric_std</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>

<span class="n">library</span><span class="w"> </span><span class="n">work</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">pkg_scala2hdl</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">pkg_enum</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>


<span class="n">entity</span><span class="w"> </span><span class="nc">ClockDivider</span><span class="w"> </span><span class="n">is</span>
<span class="w">  </span><span class="n">port</span><span class="p">(</span>
<span class="w">    </span><span class="n">clkOut</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">clk</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">reset</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">std_logic</span>
<span class="w">  </span><span class="p">);</span>
<span class="n">end</span><span class="w"> </span><span class="nc">ClockDivider</span><span class="p">;</span>

<span class="n">architecture</span><span class="w"> </span><span class="n">arch</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nc">ClockDivider</span><span class="w"> </span><span class="n">is</span>

<span class="w">  </span><span class="n">signal</span><span class="w"> </span><span class="n">zz_clkOut</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">unsigned</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="n">begin</span>
<span class="w">  </span><span class="n">clkOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_extract</span><span class="p">(</span><span class="n">zz_clkOut</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
<span class="w">  </span><span class="n">process</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span><span class="w"> </span><span class="n">reset</span><span class="p">)</span>
<span class="w">  </span><span class="n">begin</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span><span class="n">zz_clkOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_unsigned</span><span class="p">(</span><span class="s">&quot;00000000&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">elsif</span><span class="w"> </span><span class="n">rising_edge</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span><span class="n">zz_clkOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">zz_clkOut</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pkg_unsigned</span><span class="p">(</span><span class="s">&quot;00000001&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">  </span><span class="n">end</span><span class="w"> </span><span class="n">process</span><span class="p">;</span>

<span class="n">end</span><span class="w"> </span><span class="n">arch</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Generierter Verilog-Code: <code class="docutils literal notranslate"><span class="pre">ClockDivider.v</span></code></strong></p>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="c1">// Generator : SpinalHDL v1.9.1    git head : 9cba1927b2fff87b0d54e8bbecec94e7256520e4</span>
<span class="c1">// Component : ClockDivider</span>

<span class="no">`timescale</span><span class="w"> </span><span class="mh">1</span><span class="n">ns</span><span class="o">/</span><span class="mh">1</span><span class="n">ps</span><span class="w"> </span>
<span class="k">module</span><span class="w"> </span><span class="n">ClockDivider</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">output</span><span class="w">              </span><span class="n">clkOut</span><span class="p">,</span>
<span class="w">  </span><span class="k">input</span><span class="w">               </span><span class="n">clk</span><span class="p">,</span>
<span class="w">  </span><span class="k">input</span><span class="w">               </span><span class="n">reset</span>
<span class="p">);</span>

<span class="w">  </span><span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_clkOut</span><span class="p">;</span>

<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">clkOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_clkOut</span><span class="p">[</span><span class="mh">7</span><span class="p">];</span>
<span class="w">  </span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="n">reset</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="w">      </span><span class="n">_zz_clkOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">8&#39;h00</span><span class="p">;</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<span class="w">      </span><span class="n">_zz_clkOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_clkOut</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">8&#39;h01</span><span class="p">);</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">  </span><span class="k">end</span>


<span class="k">endmodule</span>
</pre></div>
</div>
</section>
<section id="pwm">
<h2><span class="section-number">6.4. </span>PWM<a class="headerlink" href="#pwm" title="Link to this heading">¶</a></h2>
<p>Dies ist ein einfaches SpinalHDL-Projekt, das ein parametrierbares PWM-Modul (Pulsweitenmodulation) implementiert. Es enthält:</p>
<ul class="simple">
<li><p>eine Hardwarebeschreibung (<code class="docutils literal notranslate"><span class="pre">Pwm.scala</span></code>)</p></li>
<li><p>eine Testbench (<code class="docutils literal notranslate"><span class="pre">PwmSim.scala</span></code>)</p></li>
<li><p>eine Verilog-Ausgabe (<code class="docutils literal notranslate"><span class="pre">PwmVerilog.scala</span></code>)</p></li>
<li><p>eine VHDL-Ausgabe (<code class="docutils literal notranslate"><span class="pre">PwmVhdl.scala</span></code>)</p></li>
<li><p>die Hilfsskripte <code class="docutils literal notranslate"><span class="pre">scripts/sim.sh</span></code> (Simulation) und <code class="docutils literal notranslate"><span class="pre">scripts/gen.sh</span></code> (HDL-Generierung)</p></li>
<li><p>und eine verständliche Erklärung des Funktionsprinzips</p></li>
</ul>
<p><strong>Projektstruktur</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pwm-spinalhdl/
├── build.sbt
├── project/
│   └── build.properties
├── src/
│   ├── main/
│   │   └── scala/
│   │       ├── Pwm.scala                 ← [1] PWM-Modul
│   │       └── PwmVerilog.scala          ← [3] Verilog-Generierung
│   │       └── PwmVhdl.scala             ← [4] VHDL-Generierung
│   └── test/
│       └── scala/
│           └── PwmSim.scala              ← [2] Simulation
├── scripts/
│   ├── sim.sh                            ←  Simulation
│   └── gen.sh                            ←  HDL-Generierung
└── generated/
│   ├── verilog/
│       └── Pwm.v
│   └── vhdl/
│       └── Pwm.vhd
</pre></div>
</div>
<p><strong>Erklärung des PWM-Moduls</strong></p>
<p>Das PWM-Modul erzeugt ein Signal, das schnell zwischen <strong>an (1)</strong> und <strong>aus (0)</strong> wechselt.<br />
Wie lange das Signal „an“ bleibt, hängt vom <strong>Duty-Cycle</strong> ab – einem Eingabewert, der angibt, wie viel Prozent der Zeit das Signal „an“ sein soll.</p>
<p><strong>Aufbau des Moduls</strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Pwm</span><span class="p">(</span><span class="n">width</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">noIoPrefix</span><span class="p">()</span>
<span class="w">  </span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;Pwm&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Bundle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">enable</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w">  </span><span class="nc">Bool</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">duty</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w">  </span><span class="nc">UInt</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">   </span><span class="c1">// 0 .. 2^width-1</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">pwmOut</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">Bool</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">dutyPct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">       </span><span class="c1">// &lt;-- OUTPUT as percentage</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Reg</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="n">bits</span><span class="p">))</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">  </span><span class="n">counter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">pwmOut</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">enable</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">counter</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">duty</span><span class="p">)</span>

<span class="w">  </span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">numWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">num</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="n">duty</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">numWidth</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nc">U</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">den</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nc">U</span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">width</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">numWidth</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">pctWide</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">den</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">den</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">dutyPct</span><span class="w">   </span><span class="o">:=</span><span class="w"> </span><span class="n">pctWide</span><span class="p">.</span><span class="n">resized</span><span class="w">          </span>

<span class="w">  </span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">enable</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;enable&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">duty</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;duty&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">pwmOut</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;pwmOut&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">io</span><span class="p">.</span><span class="n">dutyPct</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&quot;dutyPct&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Was macht das Modul?</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">width</span></code>: Gibt an, wie genau das PWM-Signal sein soll (z. B. 8 Bit → Werte von 0 bis 255).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enable</span></code>: Schaltet das PWM-Signal ein oder aus.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">duty</span></code>: Bestimmt, wie lange das Signal „an“ sein soll (je höher der Wert, desto länger).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">counter</span></code>: Zählt von 0 bis zum Maximalwert und beginnt dann wieder von vorn.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pwmOut</span></code>: Wird „an“, solange <code class="docutils literal notranslate"><span class="pre">counter</span> <span class="pre">&lt;</span> <span class="pre">duty</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dutyPct</span></code>: Zeigt den Duty-Cycle direkt in Prozent (20%, 50%, 75%, 0% oder 100%)</p></li>
</ul>
<section id="beispiel-bei-8-bit-auflosung">
<h3><span class="section-number">6.4.1. </span>Beispiel (bei 8 Bit Auflösung)<a class="headerlink" href="#beispiel-bei-8-bit-auflosung" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">duty</span> <span class="pre">=</span> <span class="pre">0</span></code> → Signal ist immer aus → 0%</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">duty</span> <span class="pre">=</span> <span class="pre">128</span></code> → Signal ist 50 % der Zeit an</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">duty</span> <span class="pre">=</span> <span class="pre">255</span></code> → Signal ist immer an → 100%</p></li>
</ul>
<p>Das Modul vergleicht einen Zähler mit einem Zielwert (<code class="docutils literal notranslate"><span class="pre">duty</span></code>).<br />
Solange der Zähler kleiner ist, ist das Signal <strong>an</strong>  danach <strong>aus</strong>.<br />
Dieser Zyklus wiederholt sich kontinuierlich.</p>
<p><strong>[1] <code class="docutils literal notranslate"><span class="pre">src/main/scala/Pwm.scala</span></code> (Code wie oben)</strong></p>
<p>Siehe oben unter „Aufbau des Moduls“.</p>
<p><strong>[2] <code class="docutils literal notranslate"><span class="pre">src/test/scala/PwmSim.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>
<span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="nn">sim</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">PwmSim</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nc">SimConfig</span><span class="p">.</span><span class="n">withVcdWave</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Pwm</span><span class="p">(</span><span class="mi">8</span><span class="p">)).</span><span class="n">doSim</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">dut</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">      </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">forkStimulus</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="w">      </span><span class="c1">// enable PWM</span>
<span class="w">      </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">enable</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="kc">true</span>

<span class="w">      </span><span class="c1">// 25% duty</span>
<span class="w">      </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">duty</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">64</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="mi">300</span><span class="p">)</span><span class="w"> </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">waitSampling</span><span class="p">()</span>

<span class="w">      </span><span class="c1">// 50% duty</span>
<span class="w">      </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">duty</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">128</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="mi">300</span><span class="p">)</span><span class="w"> </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">waitSampling</span><span class="p">()</span>

<span class="w">      </span><span class="c1">// 75% duty</span>
<span class="w">      </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">duty</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">192</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="mi">300</span><span class="p">)</span><span class="w"> </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">waitSampling</span><span class="p">()</span>

<span class="w">      </span><span class="c1">// 0% duty</span>
<span class="w">      </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">duty</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="mi">150</span><span class="p">)</span><span class="w"> </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">waitSampling</span><span class="p">()</span>

<span class="w">      </span><span class="c1">// 100% duty</span>
<span class="w">      </span><span class="n">dut</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">duty</span><span class="w"> </span><span class="o">#=</span><span class="w"> </span><span class="mi">255</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="mi">150</span><span class="p">)</span><span class="w"> </span><span class="n">dut</span><span class="p">.</span><span class="n">clockDomain</span><span class="p">.</span><span class="n">waitSampling</span><span class="p">()</span>

<span class="w">      </span><span class="n">simSuccess</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">[3]PwmVerilog.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>
<span class="k">object</span><span class="w"> </span><span class="nc">PwmVerilog</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="nc">SpinalConfig</span><span class="p">(</span><span class="n">targetDirectory</span><span class="o">=</span><span class="s">&quot;generated/verilog&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oneFilePerComponent</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">generateVerilog</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Pwm</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;Pwm&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">[4]PwmVhdl.scala</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>
<span class="k">object</span><span class="w"> </span><span class="nc">PwmVhdl</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="nc">SpinalConfig</span><span class="p">(</span><span class="n">targetDirectory</span><span class="o">=</span><span class="s">&quot;generated/vhdl&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">oneFilePerComponent</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">generateVhdl</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Pwm</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="n">setDefinitionName</span><span class="p">(</span><span class="s">&quot;Pwm&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">sim.sh</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="n">euo</span><span class="w"> </span><span class="n">pipefail</span>
<span class="n">cd</span><span class="w"> </span><span class="s">&quot;$(dirname &quot;</span><span class="n">$0</span><span class="s">&quot;)/..&quot;</span>
<span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">it</span><span class="w"> </span><span class="o">\</span>
<span class="w">  </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="p">):</span><span class="n">$</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="nc">HOME</span><span class="o">=/</span><span class="n">tmp</span><span class="w"> </span><span class="o">\</span>
<span class="w">  </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="s">&quot;$PWD&quot;</span><span class="p">:</span><span class="o">/</span><span class="n">workspace</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="o">/</span><span class="n">workspace</span><span class="w"> </span><span class="o">\</span>
<span class="w">  </span><span class="n">spinalhdl</span><span class="p">:</span><span class="n">dev</span><span class="w"> </span><span class="o">\</span>
<span class="w">  </span><span class="n">sbt</span><span class="w"> </span><span class="s">&quot;Test / runMain PwmSim&quot;</span>
<span class="n">echo</span><span class="w"> </span><span class="s">&quot;✅ PWM: VCD under simWorkspace/Pwm/&quot;</span>
</pre></div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">gen.sh</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="n">euo</span><span class="w"> </span><span class="n">pipefail</span>
<span class="n">cd</span><span class="w"> </span><span class="s">&quot;$(dirname &quot;</span><span class="n">$0</span><span class="s">&quot;)/..&quot;</span>
<span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">it</span><span class="w"> </span><span class="o">\</span>
<span class="w">  </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="p">):</span><span class="n">$</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="nc">HOME</span><span class="o">=/</span><span class="n">tmp</span><span class="w"> </span><span class="o">\</span>
<span class="w">  </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="s">&quot;$PWD&quot;</span><span class="p">:</span><span class="o">/</span><span class="n">workspace</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="o">/</span><span class="n">workspace</span><span class="w"> </span><span class="o">\</span>
<span class="w">  </span><span class="n">spinalhdl</span><span class="p">:</span><span class="n">dev</span><span class="w"> </span><span class="o">\</span>
<span class="w">  </span><span class="n">sbt</span><span class="w"> </span><span class="s">&quot;runMain PwmVerilog&quot;</span><span class="w"> </span><span class="s">&quot;runMain PwmVhdl&quot;</span>
<span class="n">echo</span><span class="w"> </span><span class="s">&quot;✅ PWM: HDL under generated/{verilog,vhdl}/&quot;</span>
</pre></div>
</div>
<p><strong>Projekt kompilieren und starten</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/sim.sh<span class="w">  </span><span class="c1">#Simulation mit VCD</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/gen.sh<span class="w">  </span><span class="c1">#HDL-Ausgabe (Verilog und VHDL)</span>
</pre></div>
</div>
<p><strong>Generierter Verilog-Code: <code class="docutils literal notranslate"><span class="pre">Pwm.v</span></code></strong></p>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="c1">// Generator : SpinalHDL v1.9.1    git head : 9cba1927b2fff87b0d54e8bbecec94e7256520e4</span>
<span class="c1">// Component : Pwm</span>

<span class="no">`timescale</span><span class="w"> </span><span class="mh">1</span><span class="n">ns</span><span class="o">/</span><span class="mh">1</span><span class="n">ps</span><span class="w"> </span>
<span class="k">module</span><span class="w"> </span><span class="n">Pwm</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">input</span><span class="w">               </span><span class="n">enable</span><span class="p">,</span>
<span class="w">  </span><span class="k">input</span><span class="w">      </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">duty</span><span class="p">,</span>
<span class="w">  </span><span class="k">output</span><span class="w">              </span><span class="n">pwmOut</span><span class="p">,</span>
<span class="w">  </span><span class="k">output</span><span class="w">     </span><span class="p">[</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">dutyPct</span><span class="p">,</span>
<span class="w">  </span><span class="k">input</span><span class="w">               </span><span class="n">clk</span><span class="p">,</span>
<span class="w">  </span><span class="k">input</span><span class="w">               </span><span class="n">reset</span>
<span class="p">);</span>

<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">21</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dutyPct_1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">21</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dutyPct_2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">21</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dutyPct_3</span><span class="p">;</span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">14</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dutyPct_4</span><span class="p">;</span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">21</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dutyPct_5</span><span class="p">;</span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dutyPct_6</span><span class="p">;</span>
<span class="w">  </span><span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_pwmOut</span><span class="p">;</span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">14</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dutyPct</span><span class="p">;</span>

<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">_zz_dutyPct_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_dutyPct_2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">_zz_dutyPct</span><span class="p">);</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">_zz_dutyPct_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_dutyPct_3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_zz_dutyPct_5</span><span class="p">);</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">_zz_dutyPct_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_dutyPct_4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mh">7&#39;h64</span><span class="p">);</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">_zz_dutyPct_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">7</span><span class="mi">&#39;d0</span><span class="p">,</span><span class="w"> </span><span class="n">duty</span><span class="p">};</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">_zz_dutyPct_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_dutyPct</span><span class="w"> </span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="mh">1</span><span class="mi">&#39;d1</span><span class="p">);</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">_zz_dutyPct_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">,</span><span class="w"> </span><span class="n">_zz_dutyPct_6</span><span class="p">};</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">pwmOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">enable</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_pwmOut</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">duty</span><span class="p">));</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">_zz_dutyPct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">15&#39;h00ff</span><span class="p">;</span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">dutyPct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dutyPct_1</span><span class="p">[</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<span class="w">  </span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="n">reset</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="w">      </span><span class="n">_zz_pwmOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">8&#39;h00</span><span class="p">;</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<span class="w">      </span><span class="n">_zz_pwmOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_pwmOut</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">8&#39;h01</span><span class="p">);</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">  </span><span class="k">end</span>


<span class="k">endmodule</span>
</pre></div>
</div>
<p><strong>Generierter VHDL-Code: <code class="docutils literal notranslate"><span class="pre">Pwm.vhd</span></code></strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="w"> </span><span class="nc">Generator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">SpinalHDL</span><span class="w"> </span><span class="n">v1</span><span class="mf">.9.1</span><span class="w">    </span><span class="n">git</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="n">cba1927b2fff87b0d54e8bbecec94e7256520e4</span>
<span class="o">--</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Pwm</span>

<span class="n">library</span><span class="w"> </span><span class="n">ieee</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">ieee</span><span class="p">.</span><span class="n">std_logic_1164</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">ieee</span><span class="p">.</span><span class="n">numeric_std</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>

<span class="n">library</span><span class="w"> </span><span class="n">work</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">pkg_scala2hdl</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">work</span><span class="p">.</span><span class="n">pkg_enum</span><span class="p">.</span><span class="n">all</span><span class="p">;</span>


<span class="n">entity</span><span class="w"> </span><span class="nc">Pwm</span><span class="w"> </span><span class="n">is</span>
<span class="w">  </span><span class="n">port</span><span class="p">(</span>
<span class="w">    </span><span class="n">enable</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">duty</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">unsigned</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">pwmOut</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">dutyPct</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">unsigned</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">clk</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">std_logic</span><span class="p">;</span>
<span class="w">    </span><span class="n">reset</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">std_logic</span>
<span class="w">  </span><span class="p">);</span>
<span class="n">end</span><span class="w"> </span><span class="nc">Pwm</span><span class="p">;</span>

<span class="n">architecture</span><span class="w"> </span><span class="n">arch</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nc">Pwm</span><span class="w"> </span><span class="n">is</span>

<span class="w">  </span><span class="n">signal</span><span class="w"> </span><span class="n">zz_pwmOut</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">unsigned</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">signal</span><span class="w"> </span><span class="n">zz_dutyPct</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">unsigned</span><span class="p">(</span><span class="mi">14</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="n">begin</span>
<span class="w">  </span><span class="n">pwmOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">enable</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">pkg_toStdLogic</span><span class="p">(</span><span class="n">zz_pwmOut</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">duty</span><span class="p">));</span>
<span class="w">  </span><span class="n">zz_dutyPct</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_unsigned</span><span class="p">(</span><span class="s">&quot;000000011111111&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">dutyPct</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_resize</span><span class="p">((((</span><span class="n">pkg_resize</span><span class="p">(</span><span class="n">duty</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pkg_unsigned</span><span class="p">(</span><span class="s">&quot;1100100&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pkg_resize</span><span class="p">(</span><span class="n">pkg_shiftRight</span><span class="p">(</span><span class="n">zz_dutyPct</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">22</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">zz_dutyPct</span><span class="p">),</span><span class="mi">7</span><span class="p">);</span>
<span class="w">  </span><span class="n">process</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span><span class="w"> </span><span class="n">reset</span><span class="p">)</span>
<span class="w">  </span><span class="n">begin</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span><span class="n">zz_pwmOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pkg_unsigned</span><span class="p">(</span><span class="s">&quot;00000000&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">elsif</span><span class="w"> </span><span class="n">rising_edge</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span><span class="n">zz_pwmOut</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">zz_pwmOut</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pkg_unsigned</span><span class="p">(</span><span class="s">&quot;00000001&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">  </span><span class="n">end</span><span class="w"> </span><span class="n">process</span><span class="p">;</span>

<span class="n">end</span><span class="w"> </span><span class="n">arch</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Ergebnis</strong></p>
<ul class="simple">
<li><p>Wir erhalten ein synthetisierbares PWM-Modul</p></li>
<li><p>Wir können das Verhalten direkt simulieren</p></li>
<li><p>Die generierte Verilog-Code (<code class="docutils literal notranslate"><span class="pre">Pwm.v</span></code>) und VHDL-Code (<code class="docutils literal notranslate"><span class="pre">Pwm.vhd</span></code>) sind für FPGA/ASIC verwendbar</p></li>
</ul>
</section>
</section>
</section>
<section id="komplexere-designs-der-vexriscv-prozessor">
<h1><span class="section-number">7. </span>Komplexere Designs: Der VexRiscv-Prozessor<a class="headerlink" href="#komplexere-designs-der-vexriscv-prozessor" title="Link to this heading">¶</a></h1>
<p>SpinalHDL eignet sich nicht nur für kleine Module wie Zähler oder PWM-Generatoren.
Es kann auch für sehr große und komplexe Designs verwendet werden. Ein bekanntes Beispiel dafür ist der <strong>VexRiscv-Prozessor</strong>.</p>
<p>Der VexRiscv ist ein vollständiger 32-Bit-RISC-V-Prozessor, der vollständig in SpinalHDL
geschrieben wurde. Er wird in vielen FPGA-Projekten eingesetzt und ist in der
Open-Source-Community weit verbreitet.</p>
<section id="architektur">
<h2><span class="section-number">7.1. </span>Architektur<a class="headerlink" href="#architektur" title="Link to this heading">¶</a></h2>
<p>Der Prozessor basiert auf einer <strong>Pipeline-Architektur</strong>. Das bedeutet, dass die
Abarbeitung von Instruktionen in mehrere Schritte aufgeteilt wird, die parallel
ausgeführt werden können.</p>
<p>Ein einfaches Bild dafür ist eine Fabrikstraße: während ein Arbeitsschritt an einer
Instruktion gerade ausgeführt wird, befindet sich die nächste Instruktion bereits
in der folgenden Station. Dadurch wird die Ausführung schneller und effizienter.</p>
<p><strong>Pipeline-Skizze:</strong></p>
<p><img alt="Pipeline sketch" src="https://github.com/user-attachments/assets/91404905-f756-4b6a-950c-4e9791b61e3d" />
Die Abbildung zeigt eine 5-Stufen-Pipeline, in der mehrere Instruktionen überlappend
bearbeitet werden.</p>
<ul class="simple">
<li><p><strong>IF (Instruction Fetch):</strong> Instruktion wird aus dem Speicher geholt.</p></li>
<li><p><strong>ID (Instruction Decode):</strong> Die Instruktion wird dekodiert, Register werden gelesen.</p></li>
<li><p><strong>OF (Operand Fetch):</strong> Operanden werden vorbereitet.</p></li>
<li><p><strong>IE (Instruction Execute):</strong> Die eigentliche Operation (z. B. Addition) wird ausgeführt.</p></li>
<li><p><strong>OS (Operand Store):</strong> Ergebnis wird in Register oder Speicher zurückgeschrieben.</p></li>
</ul>
<p>Man erkennt, dass während Instruktion 1 noch in der Ausführung ist, bereits weitere
Instruktionen in früheren Phasen bearbeitet werden. Dadurch steigert die Pipeline den
Durchsatz erheblich, ohne dass die Taktrate des Prozessors erhöht werden muss.</p>
</section>
<section id="das-pluginsystem-in-der-praxis">
<h2><span class="section-number">7.2. </span>Das Plugin‑System in der Praxis<a class="headerlink" href="#das-pluginsystem-in-der-praxis" title="Link to this heading">¶</a></h2>
<p>Eine Besonderheit des VexRiscv ist sein <strong>Plugin-System</strong>.
Anstatt alle Funktionen fest in den Prozessor einzubauen, können Entwickler einzelne Bausteine hinzufügen oder weglassen.</p>
<p>Beispiel:</p>
<ul class="simple">
<li><p>Für ein sehr kleines FPGA kann ein minimaler Prozessor ohne Cache oder Multiplikationseinheit erzeugt werden.</p></li>
<li><p>Für größere Systeme kann man zusätzliche Plugins einfügen, etwa für Multiplikation,
Caches oder Debugging.</p></li>
</ul>
<p>Im Folgenden stehen drei realistische Konfigurationen: minimal, „microcontroller-artig“ und eine Variante mit zusätzlichen Rechen-Plugins. Anschließend folgt ein schlanker Top-Level, der die vom Core erzeugten Bus-Schnittstellen nach außen führt.</p>
<p>Übliche Imports:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">import</span><span class="w"> </span><span class="nn">spinal</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="n">_</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">import</span><span class="w"> </span><span class="nn">vexriscv</span><span class="p">.</span><span class="n">_</span>
<span class="o">&gt;</span><span class="w"> </span><span class="k">import</span><span class="w"> </span><span class="nn">vexriscv</span><span class="p">.</span><span class="nn">plugin</span><span class="p">.</span><span class="n">_</span>
</pre></div>
</div>
<section id="minimaler-core-einfachste-konfiguration">
<h3><span class="section-number">7.2.1. </span>Minimaler Core (einfachste Konfiguration)<a class="headerlink" href="#minimaler-core-einfachste-konfiguration" title="Link to this heading">¶</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">VexRiscvMinimal</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">cpu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">VexRiscv</span><span class="p">(</span>
<span class="w">    </span><span class="nc">VexRiscvConfig</span><span class="p">(</span>
<span class="w">      </span><span class="n">plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">IBusSimplePlugin</span><span class="p">(),</span><span class="w">   </span><span class="c1">// Instruktionsbus, einfache Handshake-Schnittstelle</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">DBusSimplePlugin</span><span class="p">(),</span><span class="w">   </span><span class="c1">// Datenbus, einfache Handshake-Schnittstelle</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">DecoderSimplePlugin</span><span class="p">,</span><span class="w">  </span><span class="c1">// Instruktionsdecoder</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">RegFilePlugin</span><span class="p">,</span><span class="w">        </span><span class="c1">// Registerfile</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">IntAluPlugin</span><span class="w">          </span><span class="c1">// Ganzzahl-ALU</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Diese Konfiguration eignet sich für sehr kleine FPGAs und Demonstrationen. Sie hat weder
Caches noch CSR‑Funktionen und ist dadurch leicht zu verstehen</p>
<p>In diesem Beispiel wird ein Prozessor mit einem einfachen Instruktionsbus, einem Datenbus, einem Decoder, einem Registerfile und einer arithmetischen Logikeinheit (ALU) erzeugt.</p>
<p>Der VexRiscv zeigt sehr deutlich, wie mächtig SpinalHDL ist. Während klassische HDLs schnell unübersichtlich werden, wenn man modulare und parametrisierbare Designs bauen möchte, bietet SpinalHDL hier große Vorteile. Dass ein kompletter Prozessor mit Scala und SpinalHDL beschrieben werden kann und anschließend als Verilog oder VHDL generiert wird, beweist die Praxistauglichkeit dieser Sprache.</p>
</section>
<section id="mcu-profil-etwas-umfangreicher">
<h3><span class="section-number">7.2.2. </span>“MCU”-Profil (etwas umfangreicher)<a class="headerlink" href="#mcu-profil-etwas-umfangreicher" title="Link to this heading">¶</a></h3>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">VexRiscvMcu</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">cpu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">VexRiscv</span><span class="p">(</span>
<span class="w">    </span><span class="nc">VexRiscvConfig</span><span class="p">(</span>
<span class="w">      </span><span class="n">plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">IBusSimplePlugin</span><span class="p">(</span><span class="n">resetVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000000</span><span class="nc">L</span><span class="p">),</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">DBusSimplePlugin</span><span class="p">(),</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">DecoderSimplePlugin</span><span class="p">,</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">RegFilePlugin</span><span class="p">,</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">IntAluPlugin</span><span class="p">,</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">HazardSimplePlugin</span><span class="p">,</span><span class="w">     </span><span class="c1">// einfaches Hazard-Handling in der Pipeline</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">BranchPlugin</span><span class="p">,</span><span class="w">           </span><span class="c1">// Sprunglogik</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nc">CsrPlugin</span><span class="p">(</span><span class="nc">CsrPluginConfig</span><span class="p">.</span><span class="n">small</span><span class="p">(</span><span class="n">mtvecInit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000000</span><span class="nc">L</span><span class="p">))</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Diese Konfiguration ist bereits deutlich leistungsfähiger.
Mit Hazard-Handling lassen sich Pipeline-Konflikte automatisch auflösen, und mit dem CSR-Plugin (Control and Status Registers) erhält der Prozessor die Basis für Betriebssystem-ähnliche Software.
Das ist die Konfiguration, die man in einem kleinen SoC (z. B. mit UART, Timer und On-Chip-RAM) nutzen würde.</p>
</section>
<section id="variante-mit-zusatzlichen-recheneinheiten">
<h3><span class="section-number">7.2.3. </span>Variante mit zusätzlichen Recheneinheiten<a class="headerlink" href="#variante-mit-zusatzlichen-recheneinheiten" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">VexRiscvWithMulDiv</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
  <span class="n">val</span> <span class="n">cpu</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VexRiscv</span><span class="p">(</span>
    <span class="n">VexRiscvConfig</span><span class="p">(</span>
      <span class="n">plugins</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span>
        <span class="n">new</span> <span class="n">IBusSimplePlugin</span><span class="p">(</span><span class="n">resetVector</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="n">L</span><span class="p">),</span>
        <span class="n">new</span> <span class="n">DBusSimplePlugin</span><span class="p">(),</span>
        <span class="n">new</span> <span class="n">DecoderSimplePlugin</span><span class="p">,</span>
        <span class="n">new</span> <span class="n">RegFilePlugin</span><span class="p">,</span>
        <span class="n">new</span> <span class="n">IntAluPlugin</span><span class="p">,</span>
        <span class="o">//</span> <span class="n">Zusätzliche</span> <span class="n">Recheneinheiten</span><span class="p">:</span>
        <span class="n">new</span> <span class="n">MulPlugin</span><span class="p">,</span>              <span class="o">//</span> <span class="n">Multiplikation</span>
        <span class="n">new</span> <span class="n">DivPlugin</span><span class="p">,</span>              <span class="o">//</span> <span class="n">Division</span>
        <span class="n">new</span> <span class="n">BranchPlugin</span><span class="p">,</span>
        <span class="n">new</span> <span class="n">HazardSimplePlugin</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Mit dieser Konfiguration erhält der Prozessor Unterstützung für Multiplikation und Division.
Das ist besonders nützlich, wenn man Anwendungen ausführen möchte, die stark auf mathematische Operationen angewiesen sind (z. B. Signalverarbeitung oder Kryptographie).</p>
</section>
<section id="top-level-bus-aus-dem-core-herausfuhren">
<h3><span class="section-number">7.2.4. </span>Top-Level: Bus aus dem Core herausführen<a class="headerlink" href="#top-level-bus-aus-dem-core-herausfuhren" title="Link to this heading">¶</a></h3>
<p>Die Bus-Schnittstellen der Plugins lassen sich einfach nach außen führen.
So kann man den Prozessor mit Speicher, Peripherie oder einem SoC-Framework verbinden.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">VexRiscvTop</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
  <span class="n">val</span> <span class="n">io</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Bundle</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">iBus</span> <span class="o">=</span> <span class="n">master</span><span class="p">(</span><span class="n">IBusSimpleBus</span><span class="p">())</span>   <span class="o">//</span> <span class="n">Instruktionsbus</span>
    <span class="n">val</span> <span class="n">dBus</span> <span class="o">=</span> <span class="n">master</span><span class="p">(</span><span class="n">DBusSimpleBus</span><span class="p">())</span>   <span class="o">//</span> <span class="n">Datenbus</span>
  <span class="p">}</span>

  <span class="n">val</span> <span class="n">core</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VexRiscv</span><span class="p">(</span>
    <span class="n">VexRiscvConfig</span><span class="p">(</span>
      <span class="n">plugins</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span>
        <span class="n">new</span> <span class="n">IBusSimplePlugin</span><span class="p">(</span><span class="n">resetVector</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="n">L</span><span class="p">),</span>
        <span class="n">new</span> <span class="n">DBusSimplePlugin</span><span class="p">(),</span>
        <span class="n">new</span> <span class="n">DecoderSimplePlugin</span><span class="p">,</span>
        <span class="n">new</span> <span class="n">RegFilePlugin</span><span class="p">,</span>
        <span class="n">new</span> <span class="n">IntAluPlugin</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>

  <span class="o">//</span> <span class="n">Plugins</span> <span class="n">im</span> <span class="n">Core</span> <span class="n">finden</span> <span class="n">und</span> <span class="n">Interfaces</span> <span class="n">verbinden</span>
  <span class="n">private</span> <span class="n">val</span> <span class="n">iBusP</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">collectFirst</span> <span class="p">{</span> <span class="n">case</span> <span class="n">p</span><span class="p">:</span> <span class="n">IBusSimplePlugin</span> <span class="o">=&gt;</span> <span class="n">p</span> <span class="p">}</span><span class="o">.</span><span class="n">get</span>
  <span class="n">private</span> <span class="n">val</span> <span class="n">dBusP</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">collectFirst</span> <span class="p">{</span> <span class="n">case</span> <span class="n">p</span><span class="p">:</span> <span class="n">DBusSimplePlugin</span> <span class="o">=&gt;</span> <span class="n">p</span> <span class="p">}</span><span class="o">.</span><span class="n">get</span>

  <span class="n">io</span><span class="o">.</span><span class="n">iBus</span> <span class="o">&lt;&gt;</span> <span class="n">iBusP</span><span class="o">.</span><span class="n">iBus</span>
  <span class="n">io</span><span class="o">.</span><span class="n">dBus</span> <span class="o">&lt;&gt;</span> <span class="n">dBusP</span><span class="o">.</span><span class="n">dBus</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Damit steht ein Prozessor-Top-Level zur Verfügung, der wie eine normale Komponente
in andere Designs integriert werden kann.</p>
</section>
<section id="verilog-generieren">
<h3><span class="section-number">7.2.5. </span>Verilog generieren<a class="headerlink" href="#verilog-generieren" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">object</span> <span class="n">VexRiscvTopVerilog</span> <span class="p">{</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">String</span><span class="p">]):</span> <span class="n">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">SpinalVerilog</span><span class="p">(</span><span class="n">new</span> <span class="n">VexRiscvTop</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dieser kleine Generator erzeugt aus dem SpinalHDL-Design den entsprechenden Verilog-Code,
der in gängigen FPGA-Toolchains weiterverwendet werden kann.</p>
</section>
</section>
<section id="fazit">
<h2><span class="section-number">7.3. </span>Fazit<a class="headerlink" href="#fazit" title="Link to this heading">¶</a></h2>
<p>Die drei Konfigurationen zeigen, wie man mit wenigen Zeilen Code von einem sehr kleinen
Core zu einem funktionsreicheren Design gelangt. Das Plugin-System ist dabei der Schlüssel:
Es erlaubt, gezielt Fähigkeiten hinzuzufügen und gleichzeitig die Kontrolle über
Ressourcenverbrauch und Komplexität zu behalten.
Der VexRiscv verdeutlicht damit, dass SpinalHDL nicht nur für einfache Module geeignet ist,
sondern auch für komplette Prozessorarchitekturen praxistauglich eingesetzt werden kann.</p>
</section>
</section>
<section id="zusammenfassung-und-ausblick">
<h1><span class="section-number">8. </span>Zusammenfassung und Ausblick<a class="headerlink" href="#zusammenfassung-und-ausblick" title="Link to this heading">¶</a></h1>
<p>In dieser Dokumentation wurden die Grundlagen von SpinalHDL vorgestellt.
Wir haben gesehen, wie sich einfache Module wie Zähler, PWM-Generatoren oder Comparatoren
in wenigen Zeilen Code beschreiben lassen. Dabei wurde deutlich, dass SpinalHDL dank
starker Typisierung, klarer Syntax und nahtloser Integration von Simulation und Test
einen deutlichen Vorteil gegenüber klassischen HDLs bietet.</p>
<p>Am Beispiel des VexRiscv-Prozessors wurde gezeigt, dass SpinalHDL auch für
hochkomplexe Designs geeignet ist. Die modulare Architektur und das Plugin-System
ermöglichen es, Prozessorvarianten flexibel zu konfigurieren von sehr kleinen
Cores bis hin zu vollwertigen Systemen mit Multiplikation, Division und CSR-Unterstützung.
Damit wird sichtbar, wie SpinalHDL vom Prototyping bis zur realen SoC-Entwicklung
eingesetzt werden kann.</p>
<p>Ein möglicher Ausblick ist die weitere Erforschung von <strong>skalierbaren SoC-Architekturen</strong>,
die mit SpinalHDL entworfen werden. Durch die Kombination mit Open-Source-Projekten
wie LiteX oder der Integration in FPGA-Toolchains können Entwickler komplette
Systeme entwerfen, die von der einfachen Steuerlogik bis hin zu
leistungsfähigen RISC-V-Prozessoren reichen.</p>
<p>SpinalHDL ist damit nicht nur ein Werkzeug für den Einstieg,
sondern eine ernstzunehmende Alternative zu VHDL und Verilog,
die sich in Zukunft noch stärker in der Hardwareentwicklung etablieren dürfte.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">SpinalHDL Dokumentation</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Los" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Einleitung</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ziele-dieser-dokumentation">1.1. Ziele dieser Dokumentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#motivation">1.2. Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uberblick-uber-traditionelle-hdls-vhdl-verilog">1.3. Überblick über traditionelle HDLs (VHDL/Verilog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#warum-die-abkehr-sinnvoll-ist">1.4. Warum die Abkehr sinnvoll ist</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#grundlagen-von-spinalhdl">2. Grundlagen von SpinalHDL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#variablendeklaration-in-spinalhdl">2.1. Variablendeklaration in SpinalHDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#signale-vs-register">2.2. Signale vs. Register</a></li>
<li class="toctree-l2"><a class="reference internal" href="#steuerstrukturen">2.3. Steuerstrukturen</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bundles-schnittstellen">2.4. Bundles (Schnittstellen)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vektoren-und-arrays">2.5. Vektoren und Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#komponentenstruktur">2.6. Komponentenstruktur</a></li>
<li class="toctree-l2"><a class="reference internal" href="#top-level-mit-verilog-ausgabe">2.7. Top-Level mit Verilog-Ausgabe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#typisches-verhalten-vs-vhdl">2.8. Typisches Verhalten vs. VHDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#besonderheiten">2.9. Besonderheiten</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tl-dr-fur-anfanger">2.10. TL;DR für Anfänger</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#struktur-und-aufbau-eines-spinalhdl-projekts">3. Struktur und Aufbau eines SpinalHDL-Projekts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ordnerstruktur">3.1. Ordnerstruktur</a></li>
<li class="toctree-l2"><a class="reference internal" href="#entwicklungsumgebung">3.2. Entwicklungsumgebung</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beispiel-kommando">3.3. Beispiel-Kommando</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#vorteile-von-spinalhdl-gegenuber-traditionellen-hdls">4. Vorteile von SpinalHDL gegenüber traditionellen HDLs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#syntax-und-typsicherheit">4.1. Syntax und Typsicherheit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#abstraktion-und-wiederverwendbarkeit">4.2. Abstraktion und Wiederverwendbarkeit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fehlerdiagnose">4.3. Fehlerdiagnose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulation-debugging">4.4. Simulation &amp; Debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#entwicklungsworkflow">5. Entwicklungsworkflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#komponentenbeschreibung">5.1. Komponentenbeschreibung</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulationsmoglichkeiten">5.2. Simulationsmöglichkeiten</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-generieren-verilog-vhdl">5.3. Code generieren (Verilog/VHDL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zusammengefasst">5.4. Zusammengefasst:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#praxisbeispiele">6. Praxisbeispiele</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#comparator">6.1. Comparator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zahler">6.2. Zähler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#taktteiler-clock-divider">6.3. Taktteiler (Clock Divider)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pwm">6.4. PWM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#komplexere-designs-der-vexriscv-prozessor">7. Komplexere Designs: Der VexRiscv-Prozessor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#architektur">7.1. Architektur</a></li>
<li class="toctree-l2"><a class="reference internal" href="#das-pluginsystem-in-der-praxis">7.2. Das Plugin‑System in der Praxis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fazit">7.3. Fazit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#zusammenfassung-und-ausblick">8. Zusammenfassung und Ausblick</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="vorheriges Kapitel">Welcome to SpinalHDL Documention</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Bakr Aassoul.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/spinalHDL.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>